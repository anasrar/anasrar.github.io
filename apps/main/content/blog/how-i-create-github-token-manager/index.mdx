---
title: How I create GitHub token manager
date: 2022-03-10
lastmod: 2022-11-14
tags:
  - GitHub
  - C++
  - Project
showTags: 3
authors: 
  - Anas Rin
ogImage:
  svg:
    width: 306
    height: 144
  annotations:
    - type: path
      d: "M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"
      scale: 6
      options:
        stroke: "#dee2e6"
        strokeWidth: 2
        fill: "#adb5bd"
        fillWeight: 4
        hachureGap: 5

    - type: path
      x: 27
      y: 0
      d: "M16.555 3.843l3.602 3.602a2.877 2.877 0 0 1 0 4.069l-2.643 2.643a2.877 2.877 0 0 1 -4.069 0l-.301 -.301l-6.558 6.558a2 2 0 0 1 -1.239 .578l-.175 .008h-1.172a1 1 0 0 1 -.993 -.883l-.007 -.117v-1.172a2 2 0 0 1 .467 -1.284l.119 -.13l.414 -.414h2v-2h2v-2l2.144 -2.144l-.301 -.301a2.877 2.877 0 0 1 0 -4.069l2.643 -2.643a2.877 2.877 0 0 1 4.069 0z M15 9h.01"
      scale: 6
      options:
        stroke: "#dee2e6"
        strokeWidth: 3
---

## TL;DR

It's just some simple **CR~~U~~D** using **SQLite** and **AES-CBC** **128-bit** with **Git** integration.

## GitHub token

Back in December 2020, GitHub announce that start in August 13, 2021 token is require for any Git operations [<A href="https://github.blog/2020-12-15-token-authentication-requirements-for-git-operations/" newTab>blog post</A>].

Although it's good and you can set different permission and expire date on each token, I just don't want to copy token on text file every Git operations like my co-worker, so this is why I create simple token manager.

## Initial goal

The initial goal is just simple CLI CRUD who encrypt GitHub token and decrypt the token when I need without NodeJS and Python installed, just download the binary ➜ add to PATH ➜ done, and being able to move the database file from Linux to Windows and vice versa.

I choose C++ for this project, and I think fun and interesting to learn more about C++.

## Ingredients

<List
  spacing="xs"
  center
  mb="lg"
  icon={
    <ThemeIcon variant="light" color="indigo" size={24} radius="xl">
      <svg xmlns="http://www.w3.org/2000/svg" className="icon icon-tabler icon-tabler-package" width={16} height={16} viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" fill="none" strokeLinecap="round" strokeLinejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
        <polyline points="12 3 20 7.5 20 16.5 12 21 4 16.5 4 7.5 12 3"></polyline>
        <line x1={12} y1={12} x2={20} y2="7.5"></line>
        <line x1={12} y1={12} x2={12} y2={21}></line>
        <line x1={12} y1={12} x2={4} y2="7.5"></line>
        <line x1={16} y1="5.25" x2={8} y2="9.75"></line>
      </svg>
    </ThemeIcon>
  }
>
  <List.Item>C++ compiler ➜ GCC for Linux and MSVC for Windows</List.Item>
  <List.Item>CMake ➜ <A href="https://cmake.org/" newTab>site</A></List.Item>
  <List.Item>linuxdeployqt ➜ <A href="https://github.com/probonopd/linuxdeployqt" newTab>repository</A></List.Item>
  <List.Item>SQLite ➜ <A href="https://www.sqlite.org/index.html" newTab>site</A></List.Item>
  <List.Item>PicoSHA2 ➜ <A href="https://github.com/okdshin/PicoSHA2" newTab>repository</A></List.Item>
  <List.Item>plusaes ➜ <A href="https://github.com/kkAyataka/plusaes" newTab>repository</A></List.Item>
  <List.Item>argparse ➜ <A href="https://github.com/p-ranav/argparse" newTab>repository</A></List.Item>
  <List.Item>tabulate ➜ <A href="https://github.com/p-ranav/tabulate" newTab>repository</A></List.Item>
  <List.Item>clip ➜ <A href="https://github.com/dacap/clip" newTab>repository</A></List.Item>
</List>

All ingredients pack into Git submodule except compiler, CMake, and linuxdeployqt.

## Encryption

Here some pseudo code in python syntax, just give you rough idea how I implement.

export const PrismPseudoCodePython = () => {
  const str = `token: str = "ghp_TOKEN"
password: str = "very_secure_password"

final_token: str = "GAH_FLAG_" + token # add flag to token for later decrypt check
hash_password: list[int] = sha256(password) # convert password to array of number (0 - 255)

# ENCRYPT

encrypted_size: list[int] = [len(final_token)] # the aes_decrypt need original string length
encrypted_token: list[int] = aes_encrypt(final_token, hash_password) # encrypt final_token with hash_password, resulting array of number 0 - 255

final_encrypted_token: str = list_number_to_hex_string(encrypted_token + encrypted_size) # convert array number to hex string and store to database

# DECRYPT

list_number_token: list[int] = hex_string_to_list_number(final_encrypted_token)

decrypted_size: int = list_number_token.pop()
decrypted_token: str = aes_decrypt(list_number_token, hash_password, decrypted_size)

if string_start_with(decrypted_token, "GAH_FLAG_"):
    print(string_replace(decrypted_token, "GAH_FLAG_", ""))
else:
    print("password wrong")`

  return <Prism withLineNumbers language="python" mb="lg">{str}</Prism>
}

<PrismPseudoCodePython />

You can see the C++ version ➜ <A href="https://github.com/anasrar/gah/blob/ee1e0de5975a7fa6cbf84694d47b0c929401a3b7/src/gah.cpp#L223" newTab>gah.cpp:223</A>.

## Git integration

Now we have fully functional what the initial goal is, store the token and copy to clipboard when we need it.

![terminal output encrypt and decrypt](/assets/blog/how-i-create-github-token-manager/terminal-output-encrypt-decrypt.png)

Did you know you can set username and token in GitHub remote or GitHub clone but only support for HTTPS protocol as far as I know, something like this.

export const PrismGitHubProtocol = () => {
  const str = `# git clone
git clone https://username:token@github.com/username/repository.git

# git push
git push https://username:token@github.com/username/repository.git branch

# git pull
git pull https://username:token@github.com/username/repository.git branch`

  return <Prism language="bash" mb="lg">{str}</Prism>
}

<PrismGitHubProtocol />

With that you can create something like this.

export const PrismGitExec = () => {
  const str = `command: str = "git push https://" + username + ":" + token + "@" + remove_http(remote) + " " + branch;
exec(command);`

  return <Prism withLineNumbers language="bash" mb="lg">{str}</Prism>
}

<PrismGitExec />

And the result when implemented.

![terminal output](/assets/blog/how-i-create-github-token-manager/terminal-output.png)

## Binary file

In Windows is pretty easy to build and distribute the binary file into single exe since all library is a static library, Linux in another hand is hard, like Linus Torvalds say in **DebConf 14_ QA with Linus Torvalds talk** [<A href="//youtu.be/5PmHRSeA2c8?t=333" newTab>video</A> 05:33].

> We basically don't make binaries for Linux. Why? Because binaries for Linux desktop applications is a major f*ing pain in the ass.
>
> – Linus Torvalds

Basically most Linux applications using shared library (you can call it dependency), and the library it self should be installed and compatible with the binary (the library version when the binary it's build).

And I found that AppImage is the solution (Flatpak and Snap is also good, but I prefer using AppImage because it easy to understand), AppImage is a Linux format file allow to pack all shared library that you need into execute binary that self extract and container when it execute, more information on <A href="https://appimage.org" newTab>appimage.org/</A>.

linuxdeployqt allow to automatically pack all shared library that we need on binary file into single AppImage file, although linuxdeployqt mainly to generate AppImage for Qt application but it can use for general application, more information on <A href="https://github.com/probonopd/linuxdeployqt" newTab>github.com/probonopd/linuxdeployqt</A>.

At first time I use AppImage, but I realize that all library that I use is capable to static link.

## GitHub Actions

Now the final thing is GitHub Actions, let the GitHub Actions compile both for Linux and Windows and automatically create release and upload the binary file, here's how I do it ➜ <A href="https://github.com/anasrar/gah/blob/main/.github/workflows/build_release.yml" newTab={true}>build_release.yml</A>, and also others automation for CI and PR test.

**AND IT'S FREE** for public repository as far as I know.

![free real estate](//c.tenor.com/sP4SQzZ4I1AAAAAM/minecraft-free-real-estate.gif)

### Flow actions

```yaml flowchart
svg:
  width: 10
  height: 10
  layoutCoord: "center"
  nodeWidth: 170
  nodeHeight: 40
  nodeRadius: 12
  nodeGap: 40
  nodeOptions:
    stroke: "#748ffc"
    strokeWidth: 4
    fill: "#364fc7"
    fillStyle: "solid"
  lineOptions:
    strokeWidth: 4
    stroke: "#364fc7"
  fonts:
    - url: "https://fonts.googleapis.com/css2?family=Architects+Daughter"
  labelTextFill: "#fff"
  labelTextFontSize: "22"
  labelTextFontFamily: "Architects Daughter"
data:
  - id: "linux"
    label: "build linux"

  - id: "windows"
    label: "build windows"

  - id: "testlinux"
    label: "test linux"
    parent:
      - "linux"
      - "windows"
    options:
      stroke: "#ffa94d"
      fill: "#d9480f"

  - id: "testwindows"
    label: "test windows"
    parent:
      - "testlinux"
    options:
      stroke: "#ffa94d"
      fill: "#d9480f"

  - id: "release"
    parent:
      - "testwindows"
    options:
      stroke: "#38d9a9"
      fill: "#087f5b"
```

## Roadmap

<List
  spacing="xs"
  center
  mb="lg"
  icon={
    <ThemeIcon variant="light" color="indigo" size={24} radius="xl">
      <svg xmlns="http://www.w3.org/2000/svg" className="icon icon-tabler icon-tabler-focus-2" width={16} height={16} viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" fill="none" strokeLinecap="round" strokeLinejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
        <circle cx={12} cy={12} r=".5" fill="currentColor"></circle>
        <circle cx={12} cy={12} r={7}></circle>
        <line x1={12} y1={3} x2={12} y2={5}></line>
        <line x1={3} y1={12} x2={5} y2={12}></line>
        <line x1={12} y1={19} x2={12} y2={21}></line>
        <line x1={19} y1={12} x2={21} y2={12}></line>
      </svg>
    </ThemeIcon>
  }
>
  <List.Item>Add more Git command flags.</List.Item>
  <List.Item>BASH auto completion.</List.Item>
</List>


## What I learn

<List
  spacing="xs"
  center
  mb="lg"
  icon={
    <ThemeIcon variant="light" color="indigo" size={24} radius="xl">
      <svg xmlns="http://www.w3.org/2000/svg" className="icon icon-tabler icon-tabler-square-check" width={16} height={16} viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" fill="none" strokeLinecap="round" strokeLinejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
        <rect x={4} y={4} width={16} height={16} rx={2}></rect>
        <path d="M9 12l2 2l4 -4"></path>
      </svg>
    </ThemeIcon>
  }
>
  <List.Item>Add more Git command flags.</List.Item>
  <List.Item>BASH auto completion.</List.Item>
  <List.Item>Use fixed width integer types for better portability and serialization ➜ <A href="//en.cppreference.com/w/c/types/integer" newTab>en.cppreference.com/w/c/types/integer</A>.</List.Item>
  <List.Item>Shared and static library.</List.Item>
  <List.Item>CMake configuration.</List.Item>
  <List.Item>AppImage structure ➜ <A href="//docs.appimage.org/packaging-guide/manual.html" newTab>docs.appimage.org/packaging-guide/manual.html</A>.</List.Item>
  <List.Item>Github actions.</List.Item>
  <List.Item>Many more.</List.Item>
</List>

## Conclusion

It was fun learning C++, CMake, and AppImage in this project, the thing that bothering me is I'm too lazy to write any validation command before execute, resulting security concern when user input malicious string.

But as long the initial goal is achieve, it's ok for me. Thank you so much for reading this post, feel free to contribute to this project.

Project repository ➜ <A href="//github.com/anasrar/gah" newTab>github.com/anasrar/gah</A>, have a nice day.

import { List, ThemeIcon } from "@mantine/core";
import { Prism } from "@mantine/prism";
import { A } from "markdown";
